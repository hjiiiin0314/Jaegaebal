<!DOCTYPE html>
<html xmlns:th="http://www.thymeleaf.org"
	  xmlns:layout="http://www.ultraq.net.nz/thymeleaf/layout"
	  layout:decorate="layout/default">
<th:block layout:fragment="customCss">
	<link rel="stylesheet" type="text/css" th:href="@{/css/chaeyoung.css}">
</th:block>
	<th:block layout:fragment="customTitle">
		<title th:text="${title}"></title> 
	</th:block>

	<th:block layout:fragment="customContent">
<!------------------- 코딩 소스 들어갈곳 Start ---------------------------------------------->
		<div class="app-main__inner">
		        <div class="app-page-title">
               <div class="page-title-wrapper">
                   <div class="page-title-heading">
                   	채용공고 게시판
					</div>
                       <div class="page-title-actions">
                           <button type="button" data-toggle="tooltip" title="" data-placement="bottom" class="btn-shadow mr-3 btn btn-dark" data-original-title="공을 넣으려면 일단 공을 차야 한다.">
                               <i class="fa fa-star"></i>
                           </button>

                       </div>    
                    </div>
               </div>   
			<div class="card-body">
				<div class="row">

<div class="col-md-12 naemam">
                                <div class="main-card mb-3 card">
                                    <div class="card-body">
                                       
                                        <div id="carouselExampleControls1" class="carousel slide" data-ride="carousel">
                                            <div class="carousel-inner">
                                                <div class="carousel-item">
                                                    <img class="d-block w-100" src="img/1.png" alt="First slide">
                                                </div>
                                                <div class="carousel-item active">
                                                    <img class="d-block w-100" src="img/2.png" alt="Second slide">
                                                </div>
                                                <div class="carousel-item">
                                                    <img class="d-block w-100" src="img/3.png" alt="Third slide">
                                                </div>
                                            </div>
                                            <a class="carousel-control-prev" href="#carouselExampleControls1" role="button" data-slide="prev">
                                                <span class="carousel-control-prev-icon" aria-hidden="true"></span>
                                                <span class="sr-only">Previous</span>
                                            </a>
                                            <a class="carousel-control-next" href="#carouselExampleControls1" role="button" data-slide="next">
                                                <span class="carousel-control-next-icon" aria-hidden="true"></span>
                                                <span class="sr-only">Next</span>
                                            </a>
                                        </div>
                                    </div>
                                </div>
                            </div>
                </div>
			</div>

			<div class="col-md-12">
                    <div class="main-card mb-3 card">
                        <div class="card-header">채용공고 게시판
                            <div class="btn-actions-pane-right">
                                <div role="group" class="btn-group-sm btn-group">
									<input type="text">
                                    <button class="btn btn-focus">검색</button>
                                </div>
                            </div>
                        </div>
                   		 <div class="table-responsive">
                            <table class="align-middle mb-0 table table-borderless table-striped table-hover">
                                <thead>
                                <tr>
                                    <th class="text-center">구분</th>
                                    <th class="text-center">모집부서</th>
                                    <th class="text-center">구인공고제목</th>
                                    <th class="text-center">채용마감일</th>
                                    <th class="text-center">공고등록일</th>
                                    <th class="text-center">지원하기</th>
                                </tr>
                                </thead>
                                <tbody>
                                <tr th:each="cy : ${cyBoardList}" >
                               
                                    <td class="text-center text-muted" th:text="${cy.jobNumber}"></td>
                                    <td class="text-center text-muted addd" th:text="${cy.jobJojicName}"></td>
                                    <td>
                                        <div class="widget-content p-0">
                                            <div class="widget-content-wrapper">
                                                <div class="widget-content-left flex2">
                                                    <a th:href="@{/addCYPostForm(jobNumber=${cy.jobNumber})}" th:text="${cy.jobTitle}"></a>
                                                </div>
                                            </div>
                                        </div>
                                    </td>
                                    <td class="text-center deadLine" th:text="${cy.jobDeadLine}"></td>
                                    <td class="text-center" th:text="${cy.jobRegDate}"></td>
                                    <td class="text-center">
                                        <button type="button" class="btn btn-primary btn-sm applicantBtn" data-toggle="modal" data-target="#myModal">지원하기</button>
                                    </td>
                                </tr>
                                </tbody>
                            </table>
                        </div>
                        <div class="d-block text-center card-footer">
                            <button class="btn-wide btn btn-success" onclick="location.href='/addCYPostForm'">글등록하기</button>
           				</div>
			        </div>
			    </div>
			    
					<div class="modal fade" id="myModal">
					
					  <div class="modal-dialog" >
					  
					    <div class="modal-content">
					      <div class="modal-header">
					        <h4 class="modal-title">지원서작성</h4>
					        <button type="button" class="close" data-dismiss="modal" aria-label="Close"><span aria-hidden="true">&times;</span></button>
					      </div>
					      <div class="card mb-3 widget-content">
                                        <div class="widget-content-wrapper">
                                            <div class="widget-content-left">
                                                <div class="widget-heading" id="jobJojicName"></div>
                                                <div class="widget-subheading" id="jobTitle"></div>
                                            </div>
                                            <div class="widget-content-right">
                                                <div class="widget-numbers text-success"><span id="deadLineDay"></span></div>
                                            </div>
                                        </div>
                                    </div>
					      <div class="modal-body">
					          
					            <div class="form-wrap">
					                <div class="button-wrap">
					                    <div id="btn"></div>
					                    <button type="button" class="togglebtn" onclick="login()">지원하기</button>
					                    <button type="button" class="togglebtn" onclick="register()">이력서</button>
					                </div>
					                <form id="login" class="input-group appInsertForm" action="/addApplicant" method="post">
					                    <input type="hidden" id="emailCheckResult">
					                    <input type="hidden" id="appEmailCheck">
					                    <input type="email" class="input-field" name="appEmail" placeholder="Email">
					                    <button type="button" id="emailCheck" class="mb-2 mr-2 btn btn-primary btn-sm btn-block">이메일 중복 검사</button>
					                    <input type="password" class="input-field" name="appPassward" placeholder="Password">
					                    <input type="text" class="input-field" name="appName" placeholder="Name">
					                    <input type="text" class="input-field" name="appPhone" placeholder="Phone">
					                    <button class="submit" id="appBtn" type="button">지원하기</button>
					                </form>
					                <form id="register" action="" class="input-group">
					                    <input type="email" class="input-field" name="appEmail" placeholder="Email">
					                    <input type="password" class="input-field" name="appPassward" placeholder="Passward">
					                    <button class="submit" type="button">이력서 조회하기</button>
					                </form>
					            </div>
					        </div>
					    </div><!-- /.modal-content -->
					  </div><!-- /.modal-dialog -->
					</div><!-- /.modal -->
				</div>
<!------------------- 코딩 소스 들어갈곳 End ------------------------------------------------>
		

	</th:block>  
	<th:block layout:fragment="customJsScript">
	
        <script>
            var x = document.getElementById("login");
            var y = document.getElementById("register");
            var z = document.getElementById("btn");
            
            
            function login(){
                x.style.left = "50px";
                y.style.left = "450px";
                z.style.left = "0";
            }

            function register(){
                x.style.left = "-400px";
                y.style.left = "50px";
                z.style.left = "110px";
            }
            
            $(function() {
            	$('.applicantBtn').click(function() {

    	            var checkBtn = $(this);


    	            // checkBtn.parent() : checkBtn의 부모는 <td>이다.
    	            // checkBtn.parent().parent() : <td>의 부모이므로 <tr>이다.
    	            var tr = checkBtn.parent().parent();
    	            var td = tr.children();
    	            var appNumber = td.eq(0).text(); //공고번호
    	            var jobJojicName = td.eq(1).text(); //지원부서
    	            var jobTitle = td.eq(2).text(); //공고제목
    	            var deadLine = td.eq(3).text(); //마감일
    	             
    	            
    	            $('#jobJojicName').text(jobJojicName); //지원부서
      				$('#jobTitle').text(jobTitle.trim()); //공고제목
    	            
 					if(new Date(deadLine) < new Date()) {
 						alert('지원이 마감되었습니다.');
 						return false;
 					}
 					
 					var Dday = new Date(deadLine);    // D-day(deadLine)를 셋팅한다.
 					var now = new Date();                    // 현재(오늘) 날짜를 받아온다.
 					 
 					var gap = now.getTime() - Dday.getTime();    // 현재 날짜에서 D-day의 차이를 구한다.
 					var result = Math.floor(gap / (1000 * 60 * 60 * 24)) * -1;  

      				$('#deadLineDay').text('D-'+result);
            	})
            	
            	//이메일 정규 표현식
            	function email_check( email ) {
    
   					var regex=/([\w-\.]+)@((\[[0-9]{1,3}\.[0-9]{1,3}\.[0-9]{1,3}\.)|(([\w-]+\.)+))([a-zA-Z]{2,4}|[0-9]{1,3})(\]?)$/;
    				return (email != '' && email != 'undefined' && regex.test(email));
	
				}
            	//핸드폰 번호 정규식
            	function isCellPhone(p) {

            		p = p.split('-').join('');

            		var regPhone = /^((01[1|6|7|8|9])[1-9]+[0-9]{6,7})|(010[1-9][0-9]{7})$/;
            		return regPhone.test(p);

            		}
            	//이메일 중복검사 클릭시
            	$('#emailCheck').click(function() {
        			var appEmail = $('.appInsertForm input[name="appEmail"]');
        			if(appEmail.val() == ''){
        				alert('이메일을 입력해주세요.');
        			
        				return false;
        			}else if(!email_check(appEmail.val())) {
        				alert('올바른 이메일을 입력해 주세요.');
        				
        				return false;
        			}
        			
        			var request = $.ajax({
        				  url: "emailCheck", //컨트롤러 맵핑
        				  method: "POST",
        				  data: { appEmail : appEmail.val() },
        				  dataType: "json" // json방식으로 값 전달
        				});
        				 
        				request.done(function( data ) {
        					//히든 inputBox 중복검사여부를 담는다.
        					var emailCheckResult = $('#emailCheckResult');
        					var appEmailCheck = $('#appEmailCheck');
        					if(data == 0){
        						alert('지원가능한 이메일 입니다.');
        						//히든 input 박스에 중복확인 통과한 이메일값을 담는다.
        						appEmailCheck.val(appEmail.val());
        					}else{
        						var result = confirm('이미 지원하신 이메일입니다. 수정화면으로 이동 하시겠습니까?');
        						
        						if(result) {
        							alert('화면이동');
        						}
        					}
        	                //히든 input박스에 값 넣어주기.중복검사 했는지 안했는지 확인하기 위함.
        					emailCheckResult.val(data);	
        					
        					console.log(data, '이메일 중복검사 결과');
        					//이 값을 이용하면 회원가입 버튼을 눌렀을 때 중복확인을 끝낸 이메일로 지원을 시도하는지 안하는지 알 수 있음. 
        					console.log(appEmailCheck.val(),'이메일');
        				});
        				 
        				request.fail(function( jqXHR, textStatus ) {
        				  alert( "Request failed: " + textStatus );
        				});
            	});;
            	//이력서 작성전 지원자정보 입력 유효성검사
            	$('#appBtn').click(function() {
            		var appEmail = $('.appInsertForm input[name="appEmail"]');
            		var appPassward = $('.appInsertForm input[name="appPassward"]');
            		var appName = $('.appInsertForm input[name="appName"]');
            		var appPhone = $('.appInsertForm input[name="appPhone"]');
					var emailCheckResult = $('#emailCheckResult');
					var appEmailCheck = $('#appEmailCheck');
            		

            		if(appEmail.val() == '') {
            			alert('이메일을 입력해 주세요');
            			appEmail.focus();
            			return false;	
            		}else if(appPassward.val() == '') {
            			alert('비밀번호를 입력해 주세요');
            			appPassward.focus();
            			return false;     	
            		}else if(appName.val() == '') {
            			alert('이름을 입력해 주세요');
            			appName.focus();
            			return false;	
            		}else if(appPhone.val() == '') {
            			alert('핸드폰번호를 입력해 주세요');
            			appPhone.focus();
            			return false;
            		}else if(!isCellPhone(appPhone.val())) {
            			alert('올바른 핸드폰번호를 입력해 주세요');
            			appPhone.focus();
            			return false;
            		}else if(appEmail.val() != appEmailCheck.val() || emailCheckResult.val() != 0) {
            			alert('이메일 중복검사를 해주세요');
            			appEmail.focus();
            			return false;	
            		}
            		
            		if(confirm('이력서작성 화면으로 이동합니다')) {            			
            			$('.appInsertForm').submit();
            		}
            	});
            });

        </script>
	</th:block>
</html>
