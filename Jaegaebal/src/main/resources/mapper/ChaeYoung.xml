<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper
    PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
    "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="kr.or.jaegaebal.mapper.ChaeYoungMapper">
	<resultMap type="ChaeYoungBoard" id="ChaeYoungBoardResultMap">
		<result column="job_number" 		property="jobNumber"/>
		<result column="job_jojic_code" 	property="jobJojicCode"/>
		<result column="job_jojic_name" 	property="jobJojicName"/>
		<result column="job_title" 			property="jobTitle"/>
		<result column="job_content" 		property="jobContent"/>
		<result column="job_career" 		property="jobCareer"/>
		<result column="job_deadline"		property="jobDeadLine"/>
		<result column="job_reg_date" 		property="jobRegDate"/>
		<result column="job_reg_staff"		property="jobRegStaff"/>
	</resultMap>
	<resultMap type="ChaeYoungApplicant" id="ChaeYoungApplicantResultMap">
	
		<result column="app_email" 		property="appEmail"/>
		<result column="job_number" 	property="jobNumber"/>
		<result column="app_passward" 	property="appPassward"/>
		<result column="app_name" 		property="appName"/>
		<result column="app_phone" 		property="appPhone"/>
		<result column="app_reg_date"	property="appRegDate"/>
		<result column="app_num_code"	property="appNumCode"/>
		<result column="app_final_state"	property="appFinalState"/>

	</resultMap>


	<!-- 구인공고 게시글 등록 -->
	<insert id="addCYBoardPost" parameterType="ChaeYoungBoard">
	
		<selectKey resultType="String" keyProperty="jobNumber" order="BEFORE">
			SELECT
				case 
					when 
						MAX(cast(SUBSTRING(job_number,'3')AS DECIMAL))+1 <![CDATA[<]]> 10 
					then 
						CONCAT('cy000',max(cast(SUBSTRING(job_number,'3')AS DECIMAL))+1)
					when 
						max(cast(SUBSTRING(job_number,'3')AS DECIMAL))+1 <![CDATA[<]]> 100 
					then 
						CONCAT('cy00',max(cast(SUBSTRING(job_number,'3')AS DECIMAL))+1)
					when 
						max(cast(SUBSTRING(job_number,'3')AS DECIMAL))+1 <![CDATA[<]]> 1000 
					then 
						CONCAT('cy0',max(cast(SUBSTRING(job_number,'3')AS DECIMAL))+1)
					else
						CONCAT('cy',max(cast(SUBSTRING(job_number,'3')AS DECIMAL))+1) END as jobNumber				
			FROM
				cy_job_board
		</selectKey>
		INSERT INTO cy_job_board(
			job_number
			,job_jojic_code
			,job_jojic_name
			,job_title
			,job_content
			,job_career
			,job_deadline
			,job_reg_date
			,job_reg_staff
			)
			VALUES (
			#{jobNumber}
			,#{jobJojicCode}
			,#{jobJojicName}
			,#{jobTitle}
			,#{jobContent}
			,#{jobCareer}
			,#{jobDeadLine}
			,NOW()
			,'개발자'
			)
	</insert>
	<!-- 구인공고 게시글 가져오기 -->
	<select id="cyBoardList" parameterType="String" resultMap="ChaeYoungBoardResultMap">
		SELECT job_number, job_jojic_code, job_jojic_name, job_title, job_content, job_career, job_deadline, job_reg_date, job_reg_staff
		FROM cy_job_board
		<!-- 구인공고리스트에서 공고 클릭시 -->
		<if test="jobNumber != null and jobNumber neq ''.toString()">
		WHERE job_number=#{jobNumber}
		</if>
	</select>
	<!-- 부서 가져오기 -->
	<select id="getJojicCode" resultType="Jojic">
		SELECT 
			jojic_code as jojicCode
			,jojic_name as jojicName
		FROM is_jojic
	</select>
	<!-- 지원자 이메일 중복검사 -->
	<select id="emailCheck" parameterType="String" resultType="String">
		SELECT 
			app_email as appEmail
		FROM 
			cy_applicant_register
		WHERE
			app_email = #{appEmail} 
	</select>
	<!-- 지원자 정보 가져오기 -->
	<select id="appManagement" resultMap="ChaeYoungApplicantResultMap">
		SELECT 
			areg.app_email
			,areg.job_number
			,areg.app_passward
			,areg.app_name
			,areg.app_phone
			,areg.app_reg_date
			,anum.app_num_code
			,anum.app_final_state
		FROM 
			cy_applicant_register AS areg
			INNER JOIN
			cy_applicant_number AS anum
			on
			areg.app_email = anum.app_email
	</select>
</mapper>